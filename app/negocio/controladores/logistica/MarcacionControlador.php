<?php

namespace MiApp\negocio\controladores\logistica;

use MiApp\negocio\generico\GenericoControlador;
use MiApp\persistencia\dao\PedidosDAO;

class MarcacionControlador extends GenericoControlador
{
    private $PedidosDAO;

    public function __construct(&$cnn)
    {
        parent::__construct($cnn);
        parent::validarSesion();
        $this->PedidosDAO = new PedidosDAO($cnn);
    }

    public function marcacion_remesa()
    {
        parent::cabecera();
        $this->view(
            'logistica/marcacion_remesa'
        );
    }

    public function consulta_direccion_pedido()
    {
        header('Content-Type: application/json');
        $num_pedido = $_POST['num_pedido'];
        $datos = $this->PedidosDAO->consulta_pedido_direccion($num_pedido);
        if (!empty($datos)) {

            $nombre_ciudad = self::eliminar_acentos($datos[0]->nombre_ciudad);
            $nombre_depa = self::eliminar_acentos($datos[0]->nombre_depa);
            $contacto = self::eliminar_acentos($datos[0]->contacto);

            $datos[0]->nombre_ruta = RUTA_ENTREGA[$datos[0]->ruta];
            $empresa = $datos[0]->nombre_empresa;
            $direccion = $datos[0]->direccion;
            if (strlen($empresa) >= 47) {
                $nombre1 = substr($empresa, 0, 47);
                $nombre2 = substr($empresa, 48, strlen($empresa));
            } else {
                $nombre1 = substr($empresa, 0, strlen($empresa));
                $nombre2 = "";
            }
            if (strlen($direccion) >= 37) {
                $direccion1 = substr($empresa, 0, 40);
                $direccion2 = substr($empresa, 41, strlen($direccion));
            } else {
                $direccion1 = substr($direccion, 0, strlen($direccion));
                $direccion2 = "";
            }
            if (strlen(DIRECCION_EMPRESA) >= 50) {
                $direccionmpre1 = substr(DIRECCION_EMPRESA, 0, 50);
                $direccionmpre2 = substr(DIRECCION_EMPRESA, 51, strlen(DIRECCION_EMPRESA));
            } else {
                $direccionmpre1 = substr(DIRECCION_EMPRESA, 0, strlen(DIRECCION_EMPRESA));
                $direccionmpre2 = "";
            }
            $prueba = '
                ^XA ^PW831 ^CI28 ^LL1199 ^LS0 
                ^FO20,450^GFA,6010,6010,10,N03FF,M07JF8,L07LF8,K01FF8007FE,K07F8J07F8,J01FCL0FC,J03FM03F,J07CM01F8,I01FN033E,I03EN071F,
                I07CM01F0F8,I0FN07F03C,001EN0FF01E,003CM03F700F,0078M0FC7007,0078L03F070078,00FM07E07003C,01EL01F807001E,01CL07E007I0E,
                03CK01F8007I0F,038K03FI07I07,07L0FCI07I078,07K03FJ07I038,0EK0FCJ07I03C,0EJ01FCJ07I01C,0EJ07FF83DFFI01C,1CI01F98E7CE7I01E,
                1CI07E1BEFCE3J0E,1CI0FC1KF7J0E,3C003F01BDFFDFJ0E,3800FC019FFEDFJ07,3803FI0IFCFFJ07,3807EI0EFFDF7J07,381F8I06KFJ07,
                387EJ0FFDFE7J07,38F8I01BIF7FJ07,3BFK03IF3FJ07,3FEK06FFD3FJ07,3BFK039F89FJ07,38FCJ039F077J07,383FJ06EEIFJ07,381F8I0EEFFCFJ07,
                3807EI0441FE7J07,3801F8008CFC67J07,38007E01FDF8FFJ0F,1C003F01FDF9EFJ0E,1CI0FC1FCFFEFJ0E,1CI03F12CFFCFJ0E,1EJ0F9FDJFI01E,
                0EJ07IF99FFI01C,0EJ01F8J07I01C,0FK07EJ07I038,07K03FJ07I038,078K0FCI07I078,038K03FI07I07,03CL0FC007I0F,01EL07E007001E,
                00EL01F807001C,00FM07E07003C,0078L01F870078,003CM0FC300F,003EM03F701E,001FN0FF03E,I0F8M03F07C,I07CM01F0F8,I03EN071F,J0F8M03FC,
                J07EM01F8,J01F8L03E,K0FEK01FC,K03FCJ0FF,L0MFC,L01KFE,M03JF,O0FC,,::::::::::::::K04003C,J01E007FF,J03E007FFE,J0FF007IF8,
                I01FF007JF,I03FF807JF8,I07FFC07JFE,I07FFC07KF,I0IFE07KFC,001IFE07KFE,001IFE07LF,003IF807LF8,003IF007LF8,003FFE007FE3IFC,
                007FFC007FE0IFE,007FF8007FE03IF,007FF8007FE01IF8,007FFI07FE00IF8,007FFI07FE007FFC,00FFEI07FE003FFC,00FFEI07FE001FFE,
                00FFEI07FEI0FFE,00FFEI07FEI07FF,:00FFEI07FEI03FF,:00FFEI07FEI03FF8,007FEI07FEI01FF8,:::007FFI07FEI01FFC,003FFI07FEI01FFC,
                :003FF8007FEI01FFC,001FFC007FEI01FFC,:001FFE007FEI01FFC,I0IF007FEI01FF8,I07FF807FEI03FF8,I07FFE07FEI03FF8,I03IF07FEI07FF8,
                I01IFC7FEI0IF8,I01LFE001IF,J0LFE001IF,J07KFE007IF,J03KFE00IFE,J01KFE03IFE,K0KFE03IFC,K07JFE03IF8,K03JFE01IF8,L0JFE01IF,
                L03IFE00FFE,M0IFE00FFC,M01FFE007F8,N01FE007F,S03E,S038,V0F,U0FF,T0IF,S0JF,Q01KF,P01LF,P0MF,N01NF,M03OF,L03PF,K01QF,J03RF,
                I03RF,003QFE,003QFC,:003NF9FFC,003MF81FFC,003LF801FFC,003KFI01FFC,003JF8I01FFC,:003JFEI01FFC,003KF8001FFC,003KFE001FFC,
                003LF001FFC,003LFC01FFC,003MF01FFC,003FF3JF81FFC,003FF0JFE1FFC,003FF03JF9FFC,003FF01MFC,003FF007LFC,003FF001LFC,003FFI0LFC,
                003FFI03KFC,003FFI01KFC,003FFJ07JFC,I0FFJ01JFC,J06K0KF,P03JFC,Q0KF,Q07JF8,Q01JFE,R0KF,R03JF,S0JF,K07CL07IF,J07FFCK01IF,
                I01JF8K07FF,I03JFCK03FF,I07KFL0FF,I0LF8K07F,I0LFCK01F,001LFEL07,001MFL07,003MFK01F,003MF8J07F,003MF8I01FF,003FFE0IFCI07FF,
                003FFC03FFC003IF,003FF801FFC00JF,003FF001FFE07JF,003FFI0FFE1KF,003FFI0FFE7KF,003FFI07NF,::003FFI07MFC,003FFI07LFE,003FFI07LF8,
                003FFI07KFE,003FFI07KF,003FFI07JF8,003FFI07IFE,003FFI07IF8,003FFI07FFC,003FFI07FF,:003FFI07FE,003FFI07FF,::003FF8007FF,
                003IF807FF,003JFEIF,003MFE,003NF,003OF,003PFC,003RF,003SF,003TF,I07SF,J01RF,L0QF,M07OF,N07NF,:N07FF3KF,N07FE01JF,N07FEI07FF,
                N07FFJ01F,N07FF,N01FF,P06,,K0FE,J07FFE,I01JF8,I03JFE,I07KF,I0LF8,I0LFC,001LFEL01,001MFL07,003MFK01F,003MF8J07F,003IF3IF8I03FF,
                003FFC07FFCI0IF,003FF803FFC003IF,003FF801FFC01JF,003FF001FFE07JF,003FFI0FFE1KF,003FFI0OF,003FFI07NF,:003FFI07MFE,003FFI07MF8,
                003FFI07LFE,003FFI07LF,003FFI07KFC,003FFI07JFE,003FFI07JF8,003FFI07IFC,003FFI07IF,003FFI07FFC,003FFI07FF,:003FFI07FE,003FFI07FF,
                ::003FF8007FF,003IFE07FF,003MFE,003NF,003NF8,003OF8,003PFE,003RF8,003SFE,003TF,I03SF,K0RF,L07PF,M03OF,N07NF,:N07FF0KF,N07FE007IF,
                N07FFI03FF,N07FFK0F,N07FF,O07F,P02,,::V03,U07F,T07FF,S07IF,R07JF,Q07KF,P0MF,O0NF,N0OF,M0PF,L0QF,K0RF,J0RFC,001RF8,003QFC,
                ::003MFE1FFC,003LFC01FFC,003KF8001FFC,003JF8I01FFC,:003JFEI01FFC,003KFI01FFC,003KFC001FFC,003LF001FFC,003LF801FFC,003LFE01FFC,
                003FF3JF81FFC,003FF1JFC1FFC,003FF07JF1FFC,003FF01JFDFFC,003FF00MFC,003FF003LFC,003FFI0LFC,003FFI07KFC,003FFI01KFC,003FFJ0KFC,
                003FFJ03JFC,J0EK0KF,P07JF8,P01JFE,Q07JF8,Q03JFE,R0KF,R07JF,R01JF,S07IF,J01F8L03IF,J0IF8L0IF,I01IFEI0FFC3FF,I03JF003IF8FF,
                I07JF807IFC7F,I0KFC0KF1F,001KFE1KF8F,001LF3KFC3,003LFBKFE,003SF,003SF8,:003FFE0OFC,003FFC03IFE0IFE,003FF801IF803FFE,
                003FF001IF801FFE,003FFI0IFI0IF,:003FFI0IFI07FF,003FFI07FFI07FF,003FFI07FFI03FF,:::::::::::::::003FF8007FFI03FF,
                003IFC07FFI03FF,003MFEI03FF,:003NFI03FF,003OF003FF,003PFC7FF,003TF,::I07SF,J01RF,L07PF,M03OF,N07NF,:N07FF1KF,N07FE00JF,
                N07FEI03FF,N07FFK0F,N07FF,N03FE,M07FFE,L07JF,K03KFC,K07LF,J01MFC,J03NF,J07NF8,J0OFE,I01PF,I03PF8,I07PFC,I0QFE,I0JFE01KF,
                001JFI01JF8,001IFCJ07IFC,003IF8J01IFE,003IFL0IFE,003FFEL07IF,007FFCL03IF,007FF8L01IF8,007FF8M0IFC,007FFN07FFC,007FFN03FFE,
                00IFN01FFE,00FFEN01FFE,00FFEO0IF,00FFEO07FF,:00FFEO03FF8,::007FEO03FF8,007FEO01FF8,007FFO01FF8,007FFO01FFC,:003FF8N01FFC,
                :003FFCN01FFC,001FFEN01FFC,001FFEN03FFC,001IFN03FF8,I0IF8M03FF8,I0IFCM07FF8,I07FFCM0IF8,I03FFEM0IF8,I03IF8K01IF,I01IFCK03IF,
                I01IFEK07IF,J0JF8I01IFE,J07JFI07IFE,J03JFE03JFC,J01QFC,K0QF8,K07PF,K03OFE,K01OFC,L07NF8,L03NF,M0MFE,J01C03LF8,J03C00LF,
                J0FE001JF8,I01FFJ07F,I03FF,I03FF8,I07FFCM04,I0IFCM0E,I0IFEL01F,001IFEL03F8,001IFCL03FC,003IF8L07FE,003IFM0FFE,003FFEL01IF,
                007FFCL01IF8,007FF8M0IF8,007FF8M07FFC,007FFN03FFC,007FFN01FFE,00IFN01FFE,00FFEO0IF,:00FFEO07FF,:00FFEO03FF8,::007FEO01FF8,
                007FFO01FF8,:007FFO01FFC,:003FF8N01FFC,:003FFCN01FFC,001FFEN01FFC,001FFEN03FFC,001IFN03FF8,I0IF8M03FF8,I0IFCM07FF8,I07FFEM0IF8,
                I03IFM0IF8,I03IF8K01IF,I01IFCK03IF,J0JFK07IF,J0JF8I01IFE,J07JFI07IFE,J03KF87JFC,J01QFC,K0QF8,K07PF,K03OFE,K01OFC,L07NF8,L03NF,
                M0MFE,M03LF8,N0KFE,O0JF,P03E,V01,U01F,T01FF,S03IF,R03JF,Q03KF,P03LF,O07MF,N07NF,M03OF,L07PF,K07QF,J07QFE,I07QFE,003QFC,
                ::003NF1FFC,003MF01FFC,003KFE001FFC,003JFCI01FFC,003JF8I01FFC,003JFCI01FFC,003KFI01FFC,003KF8001FFC,003KFE001FFC,003LF801FFC,
                003LFE01FFC,003FF7JF01FFC,003FF1JFC1FFC,003FF0KF1FFC,003FF03JF9FFC,003FF00MFC,003FF007LFC,003FF001LFC,003FFI07KFC,003FFI03KFC,
                003FFJ0KFC,003FFJ07JFC,I03FJ01JFE,P07JF8,P03JFC,Q0KF,Q03JFC,Q01KF,R07JF,R03JF,S0JF,S03IF,T0IF,T07FF,T01FF,U0FF,U03F,V0F,V07,V01,,^FS
                ^FT40,167^A0N,31,31^FH\^FDTELEFONO:^FS
                ^FT192,169^A0N,31,31^FH\^FD(601)' . TEL_EMPRESA . '^FS
                ^FT40,92^A0N,28,28^FH\^FD ^FS
                ^FT40,126^A0N,28,28^FH\^FD' . $direccionmpre2 . '^FS
                ^FT40,92^A0N,28,28^FH\^FD' . $direccionmpre1 . '^FS
                ^FT160,57^A0N,31,31^FH\^FD' . NOMBRE_EMPRESA . '^FS
                ^FT40,55^A0N,31,31^FH\^FDREMITE:^FS
                ^FT785,1073^A0B,73,72^FH\^FD' . $nombre_ciudad . ' - ' . $nombre_depa . '^FS
                ^FT670,1007^A0B,39,38^FH\^FD' . $datos[0]->num_pedido . '^FS
                ^FT191,1159^A0B,39,38^FH\^FDDESTINATARIO^FS
                ^FT670,533^A0B,39,38^FH\^FD^FS
                ^FT670,1159^A0B,39,38^FH\^FDPEDIDO:^FS
                ^FT591,975^A0B,39,38^FH\^FD' . $datos[0]->telefono . '-' . $datos[0]->celular . '^FS
                ^FT511,967^A0B,39,38^FH\^FD' . $contacto . '^FS
                ^FT438,1159^A0B,39,40^FH\^FD' . $direccion2 . '^FS
                ^FT383,967^A0B,39,40^FH\^FD' . $direccion1 . '^FS
                ^FT319,1159^A0B,39,38^FH\^FD' . $nombre2 . '^FS
                ^FT271,1007^A0B,39,38^FH\^FD' . $nombre1 . '^FS
                ^FT591,1159^A0B,39,38^FH\^FDTELEFONO:^FS
                ^FT511,1159^A0B,39,38^FH\^FDCONTACTO:^FS
                ^FT383,1159^A0B,39,38^FH\^FDDIRECCION:^FS
                ^FT271,1159^A0B,39,38^FH\^FDCLIENTE:^FS
                ^FO16,183^GB792,0,1^FS
                ^FO695,184^GB0,983,1^FS
                ^FO535,184^GB0,983,2^FS
                ^FO456,183^GB0,984,1^FS
                ^FO615,184^GB0,983,1^FS
                ^FO336,183^GB0,984,1^FS
                ^FO216,184^GB0,983,1^FS
                ^FO136,184^GB0,983,1^FS
                ^FO615,694^GB80,0,1^FS
                ^PQ1,0,1,Y^XZ
                ^XA^ID000.GRF^FS^XZ';
        }
        echo json_encode($prueba);
        return;
    }
}
